Bootstrap: docker
From: ubuntu:22.04

%help
    Apptainer/Singularity recipe for the miniWeather MPI+CUDA mini-app.
    Installs MPI, CUDA toolkit, OpenMP-capable compiler, and Python + matplotlib
    to reproduce builds on systems without matching modules.

%post
    apt-get update && DEBIAN_FRONTEND=noninteractive apt-get install -y \
        build-essential \
        openmpi-bin libopenmpi-dev \
        nvidia-cuda-toolkit \
        python3 python3-pip python3-matplotlib \
        git wget && \
        rm -rf /var/lib/apt/lists/*

%environment
    export OMP_NUM_THREADS=${OMP_NUM_THREADS:-8}
    export PATH=/usr/lib/x86_64-linux-gnu/openmpi/bin:$PATH
    export LD_LIBRARY_PATH=/usr/lib/x86_64-linux-gnu:$LD_LIBRARY_PATH

%runscript
    exec /bin/bash "$@"
